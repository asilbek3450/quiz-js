{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center animate-fade-in-up">
    <div class="col-md-8 col-lg-6">
        <div class="text-center mb-5">
            <h1 class="fw-bold text-gradient mb-3">Bilimingizni sinang</h1>
            <p class="text-muted fs-5">Test ishlash uchun ma'lumotlaringizni kiriting</p>
        </div>

        <div class="card border-0 shadow-xl">
            <div class="card-body p-4 p-md-5">
                <form method="POST">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold small text-uppercase text-muted">Ism</label>
                            <input type="text" name="name" class="form-control" required placeholder="Ismingiz">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold small text-uppercase text-muted">Familiya</label>
                            <input type="text" name="surname" class="form-control" required placeholder="Familiyangiz">
                        </div>

                        <div class="col-md-6">
                            <label class="form-label fw-bold small text-uppercase text-muted">Sinf</label>
                            <select name="grade" class="form-select" required id="grade-select">
                                <option value="" selected disabled>Tanlang...</option>
                                <option value="5">5-sinf</option>
                                <option value="6">6-sinf</option>
                                <option value="7">7-sinf</option>
                                <option value="8">8-sinf</option>
                                <option value="9">9-sinf</option>
                                <option value="10">10-sinf</option>
                                <option value="11">11-sinf</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label fw-bold small text-uppercase text-muted">Sinf harfi/raqami</label>
                            <input type="text" name="class_number" class="form-control" required
                                placeholder="Masalan: A yoki 1">
                        </div>

                        <div class="col-12">
                            <label class="form-label fw-bold small text-uppercase text-muted">Chorak</label>
                            <div class="row g-2">
                                {% for i in range(1, 5) %}
                                <div class="col-3">
                                    <input type="radio" class="btn-check" name="quarter" id="q{{ i }}" value="{{ i }}"
                                        required>
                                    <label class="btn btn-outline-primary w-100" for="q{{ i }}">{{ i }}</label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="col-12">
                            <label class="form-label fw-bold small text-uppercase text-muted">Fan</label>
                            <select name="subject_id" class="form-select" required id="subject-select">
                                <option value="" selected disabled>Oldin sinfni tanlang</option>
                                <!-- JS orqali to'ldiriladi -->
                            </select>
                            <div id="subject-warning" class="form-text text-danger d-none">
                                <i class="fas fa-exclamation-circle"></i> Bu sinf uchun fanlar topilmadi
                            </div>
                        </div>

                        <div class="col-12 mt-4">
                            <button type="submit" class="btn btn-primary w-100 py-3 fs-5">
                                <i class="fas fa-play me-2"></i> Testni Boshlash
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="{{ url_for('admin_login') }}" class="text-muted text-decoration-none small hover-primary">
                <i class="fas fa-lock me-1"></i> O'qituvchi uchun kirish
            </a>
        </div>
    </div>
</div>

<style>
    .text-gradient {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .hover-primary:hover {
        color: var(--primary) !important;
    }

    .animate-fade-in-up {
        animation: fadeInUp 0.5s ease forwards;
        opacity: 0;
        transform: translateY(20px);
    }

    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

{% block extra_js %}
<script>
    const subjects = [
        {% for subject in subjects %}
    {
        id: { { subject.id } },
        name: "{{ subject.name }}",
            grades: [{{ subject.grades }}]
        },
    {% endfor %}
    ];

    const gradeSelect = document.getElementById('grade-select');
    const subjectSelect = document.getElementById('subject-select');
    const subjectWarning = document.getElementById('subject-warning');

    gradeSelect.addEventListener('change', function () {
        const selectedGrade = parseInt(this.value);
        subjectSelect.innerHTML = '<option value="" selected disabled>Fanni tanlang</option>';

        const availableSubjects = subjects.filter(sub => sub.grades.includes(selectedGrade));

        if (availableSubjects.length > 0) {
            availableSubjects.forEach(sub => {
                const option = document.createElement('option');
                option.value = sub.id;
                option.textContent = sub.name;
                subjectSelect.appendChild(option);
            });
            subjectSelect.disabled = false;
            subjectWarning.classList.add('d-none');
        } else {
            subjectSelect.disabled = true;
            subjectWarning.classList.remove('d-none');
        }
    });
</script>
{% endblock %}
{% endblock %}